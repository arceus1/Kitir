<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Laporan Harian Divisi Sablon</title>
  <style>
    body { font-family: Arial, sans-serif; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid black; text-align: center; padding: 6px; }
    .header { display: flex; justify-content: space-between; align-items: center; }
    .title { font-weight: bold; }
    input[type="text"], input[type="number"] {
      width: 100%; border: none; text-align: center; font-family: inherit; font-size: inherit;
    }
    input:focus { outline: none; }
  </style>
</head>
<body>

<div class="header">
  <div class="title">
    CPS<br>
    LAPORAN HARIAN DIVISI SABLON (MANUAL)
  </div>
  <div>
    Shift:
    <select id="shift" onchange="generateAwal()">
      <option value="shift1">Shift 1</option>
      <option value="shift2">Shift 2</option>
    </select>
  </div>
</div>

<table>
  <thead>
    <tr>
      <th colspan="2">WAKTU</th>
      <th rowspan="2">JENIS KEGIATAN</th>
      <th rowspan="2">JUDUL SABLON</th>
      <th rowspan="2">JUMLAH BAIK</th>
    </tr>
    <tr>
      <th>AWAL</th>
      <th>AKHIR</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
  const totalBaris = 10;

  function createRow(index) {
    return `
      <tr>
        <td><input type="text" id="waktuAwal${index}" readonly></td>
        <td><input type="text" id="waktuAkhir${index}" readonly></td>
        <td><input type="text" id="jenis${index}" oninput="updateAkhirDanAwal(${index})"></td>
        <td><input type="text" name="judulSablon${index}"></td>
        <td><input type="number" name="jumlahBaik${index}" min="0" oninput="updateAkhirDanAwal(${index})"></td>
      </tr>
    `;
  }

  function renderTable() {
    const tbody = document.getElementById("tableBody");
    tbody.innerHTML = "";
    for (let i = 0; i < totalBaris; i++) {
      tbody.innerHTML += createRow(i);
    }
    generateAwal();
  }

  function generateAwal() {
    const shift = document.getElementById("shift").value;
    const jamAwal = shift === "shift1" ? 7 : 15;

    const waktu = new Date();
    waktu.setSeconds(0);
    waktu.setHours(jamAwal, 0);
    const awalStr = formatTime(waktu);
    document.getElementById("waktuAwal0").value = awalStr;

    updateAkhirDanAwal(0); // Mulai dari baris pertama
  }

  function updateAkhirDanAwal(index) {
    const jenis = document.getElementById(`jenis${index}`).value.trim().toLowerCase();
    const awal = document.getElementById(`waktuAwal${index}`).value;
    const akhirEl = document.getElementById(`waktuAkhir${index}`);
    const jumlahBaik = parseFloat(document.getElementsByName(`jumlahBaik${index}`)[0].value) || 0;

    if (!awal) return;

    const [jam, menit] = awal.split(":").map(Number);
    const date = new Date();
    date.setHours(jam, menit);

    let menitTambah = 0;

    // Pembagi khusus
    const pembagiMap = {
      "sablon a1": 4.62,
      "sablon a2": 4.10,
      "sablon b1": 5.13,
      "sablon b2": 4.62,
      "sablon c1": 4.62,
      "sablon c2": 3.08,
      "sablon d1": 6.41,
      "sablon d2": 5.64,
      "sablon e1": 7.69,
      "sablon e2": 6.92,
      "sablon f1": 5.13,
      "sablon f2": 4.62
    };
    //tinggal tambahkan jenis kegiatan disini
    if (jenis === "cuci skreen + rakel" || jenis === "persiapan") {
      menitTambah = 15;
    } else if (["setting", "breafing"].includes(jenis)) {
    menitTambah = 5;}
    else if (["istirahat"].includes(jenis)) {
    menitTambah = 60;}
    else if (pembagiMap[jenis]) {
      let hasil = jumlahBaik / pembagiMap[jenis];
      hasil = Math.ceil(hasil); // Bulatkan ke atas
      hasil = Math.round(hasil / 5) * 5; // Ke kelipatan 5
      menitTambah = hasil;
    }

    if (menitTambah > 0) {
      date.setMinutes(date.getMinutes() + menitTambah);
      akhirEl.value = formatTime(date);
    } else {
      akhirEl.value = "";
    }

    // Update waktu awal baris berikutnya
    const nextIndex = index + 1;
    if (nextIndex < totalBaris && akhirEl.value) {
      document.getElementById(`waktuAwal${nextIndex}`).value = akhirEl.value;
      updateAkhirDanAwal(nextIndex);
    } else if (nextIndex < totalBaris) {
      document.getElementById(`waktuAwal${nextIndex}`).value = "";
      document.getElementById(`waktuAkhir${nextIndex}`).value = "";
    }
  }

  function formatTime(date) {
    const hh = String(date.getHours()).padStart(2, '0');
    const mm = String(date.getMinutes()).padStart(2, '0');
    return `${hh}:${mm}`;
  }

  window.onload = renderTable;
</script>

</body>
</html>
